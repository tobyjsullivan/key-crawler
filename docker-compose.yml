version: "3"
services:
  enum-batch-gen:
    build:
      context: .
      dockerfile: ./enum-batch-gen/Dockerfile
    environment:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - BATCH_QUEUE_URL
      - START=34400000
      - BATCH_SIZE=20000
  enum:
    build:
      context: ./enum
      dockerfile: ./Dockerfile
    environment:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - BATCH_QUEUE_URL
      - QUEUER_HOSTNAME=queuer
      - QUEUER_PORT=3000
    depends_on:
      - queuer
  queuer:
    build:
      context: .
      dockerfile: ./queuer/Dockerfile
    environment:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - KEY_QUEUE_URL
      - PORT=3000
  recorder:
    build:
      context: .
      dockerfile: ./recorder/Dockerfile
    environment:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - KEY_QUEUE_URL
      - PGHOST=db
      - PGDATABASE=keys
      - PGUSER=pguser
      - PGPASSWORD=mqjwDUBaomAwXQwl
      - PGSSLMODE=disable
    depends_on:
      - db
  db:
    image: postgres:9.6
    restart: always
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_DB=keys
      - PGDATA=/var/lib/postgresql/data/pgdata
      - POSTGRES_USER=pguser
      - POSTGRES_PASSWORD=mqjwDUBaomAwXQwl
    volumes:
      - "./pgdata:/var/lib/postgresql/data/pgdata"
